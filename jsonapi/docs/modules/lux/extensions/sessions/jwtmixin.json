{"modified": "2014-11-11T17:40:26", "content_type": "text/html", "site": {"lux_version": "0.1.1-alpha.1", "template_engine": null, "year": 2014, "url": "http://quantmind.github.io/lux", "python_version": "3.4.2", "media": "/media", "date": "2014-11-11T17-40-20", "name": "Lux", "template": "doc.html"}, "html_url": "http://quantmind.github.io/lux/docs/modules/lux/extensions/sessions/jwtmixin", "head": {}, "name": "modules_lux_extensions_sessions_jwtmixin", "slug": "modules/lux/extensions/sessions/jwtmixin", "api_url": "http://quantmind.github.io/lux/jsonapi/docs/modules/lux/extensions/sessions/jwtmixin", "html": {"main": "<section id=\"page-header\" class=\"page-header-outer modules_lux_extensions_sessions_jwtmixin-header\">\n    <div class=\"layer\">\n        <div class=\"page-header\">\n            <div class=\"container fullpage\">\n                <div class=\"row fullpage\">\n                    <div class=\"col-sm-12 text-center\">\n                        <breadcrumbs></breadcrumbs>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</section>\n\n<div id=\"page-main\">\n    <div class=\"container\">\n        <div class=\"row\">\n            <div class=\"modules_lux_extensions_sessions_jwtmixin-main col-md-12\">\n                <div class=\"center-block\" style=\"max-width: 900px\" data-highlight data-hash-scroll>\n                    <h1>Source code for lux.extensions.sessions.jwtmixin</h1><div class=\"highlight\"><pre>\n<span class=\"k\">try</span><span class=\"p\">:</span>\n    <span class=\"kn\">import</span> <span class=\"nn\">jwt</span>\n<span class=\"k\">except</span> <span class=\"ne\">ImportError</span><span class=\"p\">:</span>\n    <span class=\"n\">jwt</span> <span class=\"o\">=</span> <span class=\"bp\">None</span>\n\n<span class=\"n\">__all__</span> <span class=\"o\">=</span> <span class=\"p\">[</span><span class=\"s\">&#39;JWTMixin&#39;</span><span class=\"p\">]</span>\n\n\n<div class=\"viewcode-block\" id=\"JWTMixin\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.jwtmixin.JWTMixin\">[docs]</a><span class=\"k\">class</span> <span class=\"nc\">JWTMixin</span><span class=\"p\">(</span><span class=\"nb\">object</span><span class=\"p\">):</span>\n    <span class=\"sd\">&#39;&#39;&#39;Mixin for :class:`.AuthBackend` based on JWT_</span>\n\n<span class=\"sd\">    Requires pyjwt_ package.</span>\n\n<span class=\"sd\">    .. _pyjwt: https://pypi.python.org/pypi/PyJWT</span>\n<span class=\"sd\">    .. _JWT: http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html</span>\n<span class=\"sd\">    &#39;&#39;&#39;</span>\n\n    <span class=\"k\">def</span> <span class=\"nf\">__init__</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">app</span><span class=\"p\">):</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">app</span> <span class=\"o\">=</span> <span class=\"n\">app</span>\n        <span class=\"n\">cfg</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">config</span>\n        <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">secret_key</span> <span class=\"o\">=</span> <span class=\"n\">cfg</span><span class=\"p\">[</span><span class=\"s\">&#39;SECRET_KEY&#39;</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">encode</span><span class=\"p\">()</span>\n\n<div class=\"viewcode-block\" id=\"JWTMixin.request\"><a class=\"viewcode-back\" href=\"../../../../api/sessions#lux.extensions.sessions.jwtmixin.JWTMixin.request\">[docs]</a>    <span class=\"k\">def</span> <span class=\"nf\">request</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">):</span>\n        <span class=\"sd\">&#39;&#39;&#39;Check for ``HTTP_AUTHORIZATION`` header and if it is available</span>\n<span class=\"sd\">        and the authentication type if ``bearer`` try to perform</span>\n<span class=\"sd\">        authentication using JWT_.</span>\n<span class=\"sd\">        &#39;&#39;&#39;</span>\n        <span class=\"n\">auth</span> <span class=\"o\">=</span> <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"s\">&#39;HTTP_AUTHORIZATION&#39;</span><span class=\"p\">)</span>\n        <span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"bp\">None</span>\n        <span class=\"k\">if</span> <span class=\"n\">auth</span><span class=\"p\">:</span>\n            <span class=\"n\">auth_type</span><span class=\"p\">,</span> <span class=\"n\">key</span> <span class=\"o\">=</span> <span class=\"n\">auth</span><span class=\"o\">.</span><span class=\"n\">split</span><span class=\"p\">(</span><span class=\"bp\">None</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n            <span class=\"n\">auth_type</span> <span class=\"o\">=</span> <span class=\"n\">auth_type</span><span class=\"o\">.</span><span class=\"n\">lower</span><span class=\"p\">()</span>\n            <span class=\"k\">if</span> <span class=\"n\">auth_type</span> <span class=\"o\">==</span> <span class=\"s\">&#39;bearer&#39;</span> <span class=\"ow\">and</span> <span class=\"n\">jwt</span><span class=\"p\">:</span>\n                <span class=\"k\">try</span><span class=\"p\">:</span>\n                    <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"n\">jwt</span><span class=\"o\">.</span><span class=\"n\">decode</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">secret_key</span><span class=\"p\">)</span>\n                <span class=\"k\">except</span> <span class=\"n\">jwt</span><span class=\"o\">.</span><span class=\"n\">ExpiredSignature</span><span class=\"p\">:</span>\n                    <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">app</span><span class=\"o\">.</span><span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">info</span><span class=\"p\">(</span><span class=\"s\">&#39;JWT token has expired&#39;</span><span class=\"p\">)</span>\n                <span class=\"k\">except</span> <span class=\"ne\">Exception</span><span class=\"p\">:</span>\n                    <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">app</span><span class=\"o\">.</span><span class=\"n\">logger</span><span class=\"o\">.</span><span class=\"n\">exception</span><span class=\"p\">(</span><span class=\"s\">&#39;Could not load user&#39;</span><span class=\"p\">)</span>\n                <span class=\"k\">else</span><span class=\"p\">:</span>\n                    <span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">get_user</span><span class=\"p\">(</span><span class=\"n\">request</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">data</span><span class=\"p\">)</span>\n        <span class=\"n\">request</span><span class=\"o\">.</span><span class=\"n\">cache</span><span class=\"o\">.</span><span class=\"n\">user</span> <span class=\"o\">=</span> <span class=\"n\">user</span> <span class=\"ow\">or</span> <span class=\"bp\">self</span><span class=\"o\">.</span><span class=\"n\">anonymous</span><span class=\"p\">()</span></div></div>\n</pre></div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>\n<div class='small hidden-print text-muted' id='page-footer'>\n    <div class='container'>\n        <div class='row'>\n            <div class='block col-sm-5'>\n                <div class='hidden-xs'>\n                    <ul class=\"fa-ul text-left\">\n    <li><i class=\"fa-li fa fa-copyright\"></i>2014 <a href=\"http://quantmind.com\">Quantmind</a></li>\n    <li>Site build with Lux on python 3.4.2</li>\n    <li>Docs build with <a href=\"http://sphinx-doc.org/\" target=\"_blank\">Sphinx</a></li>\n    <li><a href=\"http://quantmind.github.io/lux/docs/changelog\">Changelog</a></li>\n    <li><a href=\"http://quantmind.github.io/lux/docs/api/\">API</a></li>\n    <li><a href=\"http://quantmind.github.io/lux/docs/EXTENSIONS/\">Extensions</a></li>\n    <li><a href=\"http://quantmind.github.io/lux/images\">Images</a></li>\n</ul>\n                </div>\n                <div class='text-center visible-xs'>\n                    <ul class=\"fa-ul text-left\">\n    <li><i class=\"fa-li fa fa-copyright\"></i>2014 <a href=\"http://quantmind.com\">Quantmind</a></li>\n    <li>Site build with Lux on python 3.4.2</li>\n    <li>Docs build with <a href=\"http://sphinx-doc.org/\" target=\"_blank\">Sphinx</a></li>\n    <li><a href=\"http://quantmind.github.io/lux/docs/changelog\">Changelog</a></li>\n    <li><a href=\"http://quantmind.github.io/lux/docs/api/\">API</a></li>\n    <li><a href=\"http://quantmind.github.io/lux/docs/EXTENSIONS/\">Extensions</a></li>\n    <li><a href=\"http://quantmind.github.io/lux/images\">Images</a></li>\n</ul>\n                </div>\n            </div>\n            <div class='block col-sm-2 text-center'>\n                <div class='hidden-xs'>\n                    <p><a href='#top' title=\"Lux\" class=\"hover-opacity\">\n    <img height=50 title='Lux' src='http://quantmind.github.io/lux/media/luxsite/lux.png' alt='Lux'>\n</a></p>\n                </div>\n                <div class='visible-xs'>\n                    <p><a href='https://twitter.com/quantmind' title='Follow quantmind on twitter'>\n<i class='fa fa-twitter fa-2x'></i></a>\n<a href='https://plus.google.com/+QuantmindPlus' title='Follow quantmind on google+'>\n<i class='fa fa-google-plus-square fa-2x'></i></a>\n<a href='https://www.facebook.com/quantmind' title='Follow quantmind on facebook'>\n<i class='fa fa-facebook-square fa-2x'></i></a>\n<a href='https://github.com/quantmind/lux' title='Lux on github'>\n<i class='fa fa-github fa-2x'></i></a></p>\n                </div>\n            </div>\n            <div class='block col-sm-5'>\n                <div class='text-right hidden-xs'>\n                    <p><a href='https://twitter.com/quantmind' title='Follow quantmind on twitter'>\n<i class='fa fa-twitter fa-2x'></i></a>\n<a href='https://plus.google.com/+QuantmindPlus' title='Follow quantmind on google+'>\n<i class='fa fa-google-plus-square fa-2x'></i></a>\n<a href='https://www.facebook.com/quantmind' title='Follow quantmind on facebook'>\n<i class='fa fa-facebook-square fa-2x'></i></a>\n<a href='https://github.com/quantmind/lux' title='Lux on github'>\n<i class='fa fa-github fa-2x'></i></a></p>\n                </div>\n                <div class='text-center visible-xs'>\n                    <p><a href='#top' title=\"Lux\" class=\"hover-opacity\">\n    <img height=50 title='Lux' src='http://quantmind.github.io/lux/media/luxsite/lux.png' alt='Lux'>\n</a></p>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>"}}