require(rcfg.min(["lux/lux","angular-ui-router","angular-strap","angular-animate"]),function(a){"use strict";var b=a.$;angular.module("live.blog.nav",["lux.nav","mgcrea.ngStrap"]).constant("nav",{brandImage:a.media("blogapp/lux.svg")}).controller("NavController",["$scope","$modal","nav",function(b,c,d){var e=a.context.user,f=a.context.url,g=[],h={href:"/search",icon:"fa fa-search",title:"Search"};e?(g.push({href:f+"/write",name:"write"}),g.push({href:f+"/"+e.username,name:e.username}),g.push({href:f+"/drafts",icon:"fa fa-file-text-o",name:"drafts"}),g.push(h),g.push({href:f+"/logout",title:"logout",icon:"fa fa-sign-out fa-lg",click:"logout"})):(g.push({href:f+"/write",name:"write",target:"_self"}),g.push(h)),b.navbar={id:"home",top:!0,fluid:!1,brandImage:d.brandImage,itemsRight:g}}]).controller("SmallNavController",["$scope","nav",function(a,b){a.navbar={id:"home",toggle:!1,brandImage:b.brandImage}}]),angular.module("live.blog",["lux.form","lux.blog","templates-gaeblog","mgcrea.ngStrap"]).constant("liveBlogDefaults",{heartBeat:1e3}).config(["$modalProvider",function(a){angular.extend(a.defaults,{template:"templates/modal.tpl.html"})}]).run(["$lux",function(b){b.registerApi("blog",{getPage:function(b,c,d){var e=a.size(d);return e?2===e?this.getList({params:d}).then(function(a){var c=a.data;return c&&1===c.length?angular.extend({},b,c[0]):void 0}):this.get(d).then(function(a){return angular.extend({},b,a.data)}):b},getItems:function(b,c,d){var e=a.size(d);if("search"!==b.name){if(!e)return this.getList();if(1===e&&d.username)return this.getList({params:d})}}},"lux")}]).controller("BlogIndex",["$scope","$state","pageService","page","items",function(a,b,c,d,e){a.items=e?e.data:null,a.page=c.addInfo(d,a)}]).controller("BlogPost",["$scope","$state","$lux","$sce","$modal","pageService","page",function(a,b,c,d,e,f,g){if(g&&g.data&&(g=g.data),g.date=g.published||g.last_modified,a.page=f.addInfo(g,a),g.id){"read"===g.name||"preview"===g.name?g.edit_url="/write/"+g.id:g.preview_url="/write/"+g.id+"/preview";var h=c.api(g.api),i=e({scope:a,title:"Delete",contentTemplate:"templates/blog-delete.tpl.html",show:!1}),j=e({scope:a,title:"Publish",contentTemplate:"templates/blog-publish.tpl.html",show:!1});a.deletePost=function(b){b?h.request("DELETE",{id:g.id}).then(function(){i.hide(),c.location.path("/")},function(){a.$hide()}):i.$promise.then(i.show)},a.publishPost=function(a){if(a){var b={published:f.formatDate(),id:g.id};h.put(b).then(function(){j.hide(),c.location.path("/")})}else j.$promise.then(j.show)}}}]).directive("blogForm",["$document","$filter","formRenderer","liveBlogDefaults","$lux","$timeout",function(c,d,e,f,g,h){var i=g.api({url:"/api/blog"});return e.preCompile=function(e,j){function k(a){return e.statusClass="text-muted",a?a:r.published?r.slug:"Draft"}function l(b){if(p=!1,angular.extend(r,a._.pick(b.data,function(a,b){return"title"!==b&&"body"!==b&&"description"!==b?a:void 0})),201===b.status&&r.id){var c=g.location.path();g.location.path(c+"/"+r.id)}e.status=k()+" saved "+d("date")(new Date,"HH:mm:ss")}function m(a){p=!1;var b=k()+" - failure while syncing";a.status&&(b+=" - "+a.status),a.data&&a.data.message&&(b+=" - "+a.data.message),e.status=b,e.statusClass="text-danger"}function n(){p?e.status+=".":s&&a.now()-o>q&&(p=!0,e.status=k("sync"),s=0,i.put(r).then(l,m)),h(n,q)}var o,p,q=e.heartBeat||f.heartBeat,r=(e[e.formName],e[e.formModelName]),s=0,t=b(c[0].createElement("div")).addClass("blogStatus").attr("ng-bind","status").attr("ng-class","statusClass"),u=e.$parent.page;u&&u.id&&["id","title","description","body"].forEach(function(a){u[a]&&(r[a]=u[a])}),j.prepend(t),e.$on("fieldChange",function(){o=a.now(),++s}),e.status=k(),h(n,q)},e.directive()}]).directive("blogPage",function(){return{templateUrl:"templates/blog-page.tpl.html"}}).directive("compileHtml",["$compile",function(a){return{link:function(b,c){c.html(b.page.html),a(c.contents())(b)}}}]).directive("blogActions",["$lux",function(){return{templateUrl:"templates/blog-actions.tpl.html",scope:{},link:function(a,b,c){a.layout=c.inline?"list-inline":"list-unstyled";var d=a.$parent.page,e=a.$parent.user;d.author===e.username&&(a.page=d,a.publishPost=a.$parent.publishPost,a.deletePost=a.$parent.deletePost)}}}]).directive("searchBlog",["$lux","$timeout","liveBlogDefaults",function(b,c,d){return{restrict:"A",templateUrl:"templates/blog-search.tpl.html",link:function(e){function f(a,b){m=!1,a&&a.length?(e.message="",e.items=a):(e.items=[],void 0===b&&(b="We couldnâ€™t find anything."),e.message=b)}function g(a){f(a.data)}function h(){f(null,"Critical error!")}function i(){!m&&l&&a.now()-j>k&&(m=!0,l=0,e.text?n.getList({params:{q:e.text}}).then(g,h):f(null,"")),c(i,k)}var j,k=e.heartBeat||d.heartBeat,l=0,m=!1,n=b.api(e.page.api);e.text="",e.change=function(){++l,j=a.now()},c(i,k)}}}]),angular.module("templates-gaeblog",["templates/blog-actions.tpl.html","templates/blog-delete.tpl.html","templates/blog-page.tpl.html","templates/blog-publish.tpl.html","templates/blog-search.tpl.html","templates/modal.tpl.html"]),angular.module("templates/blog-actions.tpl.html",[]).run(["$templateCache",function(a){a.put("templates/blog-actions.tpl.html",'<ul class="blogActions" ng-class="layout" ng-if="page">\n<li ng-if="page.id && !page.published"><a class="btn btn-default" ng-click="publishPost()"> Publish</a></li>\n<li ng-if="page.preview_url"><a class="btn btn-default" ng-href="{{page.preview_url}}"> Preview</a></li>\n<li ng-if="page.edit_url"><a class="btn btn-default" ng-href="{{page.edit_url}}"> Write</a></li>\n<li ng-if="page.id"><a class="btn btn-danger" ng-click="deletePost()"> Delete</a></li>\n</ul>')}]),angular.module("templates/blog-delete.tpl.html",[]).run(["$templateCache",function(a){a.put("templates/blog-delete.tpl.html",'<div class="modal-body">\n    Deleted stories are gone forever. Are you sure?\n</div>\n<div class="modal-footer">\n  <button type="button" class="btn btn-danger" ng-click="deletePost(true)">Delete</button>\n  <button type="button" class="btn btn-default" ng-click="$hide()">Cancel</button>\n</div>')}]),angular.module("templates/blog-page.tpl.html",[]).run(["$templateCache",function(a){a.put("templates/blog-page.tpl.html",'<div class="center-block blog-title w800">\n    <h2 data-ng-bind="page.title"></h2>\n    <p class="small">by {{page.authors}} on {{page.dateText}}</p>\n    <p class="lead storyline">{{page.description}}</p>\n</div>\n<div class="center-block w900">\n    <br>\n    <br>\n    <section data-highlight data-compile-html>\n    </section>\n</div>')}]),angular.module("templates/blog-publish.tpl.html",[]).run(["$templateCache",function(a){a.put("templates/blog-publish.tpl.html",'<div class="modal-body">\n    Do you want to publish your story?\n</div>\n<div class="modal-footer">\n  <button type="button" class="btn btn-default" ng-click="publishPost(true)">Publish</button>\n  <button type="button" class="btn btn-default" ng-click="$hide()">Cancel</button>\n</div>')}]),angular.module("templates/blog-search.tpl.html",[]).run(["$templateCache",function(a){a.put("templates/blog-search.tpl.html",'<div class="searchBox" ng-show="page.name == \'search\'">\n<input class="borderless text-jumbo" type="text" placeholder="Type to search" ng-change=\'change($event)\' ng-model=\'text\'>\n<p class="lead text-center" ng-if="message" ng-bind="message" style="margin-top: 20px"></p>\n</div>')}]),angular.module("templates/modal.tpl.html",[]).run(["$templateCache",function(a){a.put("templates/modal.tpl.html",'<div class="modal" tabindex="-1" role="dialog">\n  <div class="modal-dialog">\n    <h3 class="opverlay-title" ng-show="title" ng-bind="title"></h3>\n    <div ng-bind="content"></div>\n  </div>\n</div>')}]),angular.module("monospaced.elastic",[]).constant("msdElasticConfig",{append:""}).directive("msdElastic",["$timeout","$window","msdElasticConfig",function(a,b,c){return{require:"ngModel",restrict:"A, C",link:function(d,e,f,g){function h(){var a=r;n=k,u=getComputedStyle(k),angular.forEach(C,function(b){a+=b+":"+u.getPropertyValue(b)+";"}),t.setAttribute("style",a)}function i(){var b,c,e,f,g;n!==k&&h(),o||(o=!0,t.value=k.value+p,t.style.overflowY=k.style.overflowY,b=""===k.style.height?"auto":parseInt(k.style.height,10),c=getComputedStyle(k).getPropertyValue("width"),"px"===c.substr(c.length-2,2)&&(f=parseInt(c,10)-x.width,t.style.width=f+"px"),e=t.scrollHeight,e>B?(e=B,g="scroll"):A>e&&(e=A),e+=x.height,k.style.overflowY=g||"hidden",b!==e&&(k.style.height=e+"px",d.$emit("elastic:resize",l)),a(function(){o=!1},1))}function j(){o=!1,i()}var k=e[0],l=e;if("TEXTAREA"===k.nodeName&&b.getComputedStyle){l.css({overflow:"hidden","overflow-y":"hidden","word-wrap":"break-word"});var m=k.value;k.value="",k.value=m;var n,o,p=f.msdElastic?f.msdElastic.replace(/\\n/g,"\n"):c.append,q=angular.element(b),r="position: absolute; top: -999px; right: auto; bottom: auto;left: 0; overflow: hidden; -webkit-box-sizing: content-box;-moz-box-sizing: content-box; box-sizing: content-box;min-height: 0 !important; height: 0 !important; padding: 0;word-wrap: break-word; border: 0;",s=angular.element('<textarea tabindex="-1" style="'+r+'"/>').data("elastic",!0),t=s[0],u=getComputedStyle(k),v=u.getPropertyValue("resize"),w="border-box"===u.getPropertyValue("box-sizing")||"border-box"===u.getPropertyValue("-moz-box-sizing")||"border-box"===u.getPropertyValue("-webkit-box-sizing"),x=w?{width:parseInt(u.getPropertyValue("border-right-width"),10)+parseInt(u.getPropertyValue("padding-right"),10)+parseInt(u.getPropertyValue("padding-left"),10)+parseInt(u.getPropertyValue("border-left-width"),10),height:parseInt(u.getPropertyValue("border-top-width"),10)+parseInt(u.getPropertyValue("padding-top"),10)+parseInt(u.getPropertyValue("padding-bottom"),10)+parseInt(u.getPropertyValue("border-bottom-width"),10)}:{width:0,height:0},y=parseInt(u.getPropertyValue("min-height"),10),z=parseInt(u.getPropertyValue("height"),10),A=Math.max(y,z)-x.height,B=parseInt(u.getPropertyValue("max-height"),10),C=["font-family","font-size","font-weight","font-style","letter-spacing","line-height","text-transform","word-spacing","text-indent"];l.data("elastic")||(B=B&&B>0?B:9e4,t.parentNode!==document.body&&angular.element(document.body).append(t),l.css({resize:"none"===v||"vertical"===v?"none":"horizontal"}).data("elastic",!0),k.oninput="onpropertychange"in k&&"oninput"in k?k.onkeyup=i:i,q.bind("resize",j),d.$watch(function(){return g.$modelValue},function(){j()}),d.$on("elastic:adjust",function(){h(),j()}),a(i),d.$on("$destroy",function(){s.remove(),q.unbind("resize",j)}))}}}}]),a.bootstrap("gaeblog",["live.blog","live.blog.nav","monospaced.elastic"])});