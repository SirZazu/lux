define(["lux"],function(a){!function(){function a(a){return a>0?1:0>a?-1:0}function b(){function b(a){a instanceof Array?a.each(c):d3.select(this).each(c)}function c(b){var c=d3.select(this),n=30*("function"==typeof d?d(b):d),o=80*("function"==typeof e?e(b):e),p=7*("function"==typeof f?f(b):f),q=10*("function"==typeof g?g(b):g),r=10*("function"==typeof h?h(b):h),s=10*("function"==typeof i?i(b):i),t=10*("function"==typeof j?j(b):j),u=3*("function"==typeof k?k(b):k),v=[{x:70,y:60},{x:120,y:80},{x:120-n,y:110},{x:120-n,y:160},{x:20+n,y:160},{x:20+n,y:110},{x:20,y:80}];c.selectAll("path.face").data([v]).enter().append("path").attr("class","face").attr("d",m);var w=[{x:70,y:60},{x:120,y:80},{x:140,y:45-o},{x:120,y:45},{x:70,y:30},{x:20,y:45},{x:0,y:45-o},{x:20,y:80}];c.selectAll("path.hair").data([w]).enter().append("path").attr("class","hair").attr("d",m);var x=[{x:70,y:130+p},{x:110-n,y:135-p},{x:70,y:140+p},{x:30+n,y:135-p}];c.selectAll("path.mouth").data([x]).enter().append("path").attr("class","mouth").attr("d",l);var y=[{x:70,y:110-q},{x:70+r,y:110+q},{x:70-r,y:110+q}];c.selectAll("path.nose").data([y]).enter().append("path").attr("class","nose").attr("d",l);var z=[{x:55,y:90-s},{x:55+t,y:90},{x:55,y:90+s},{x:55-t,y:90}],A=[{x:85,y:90-s},{x:85+t,y:90},{x:85,y:90+s},{x:85-t,y:90}];c.selectAll("path.leye").data([z]).enter().append("path").attr("class","leye").attr("d",m),c.selectAll("path.reye").data([A]).enter().append("path").attr("class","reye").attr("d",m),c.append("path").attr("class","lbrow").attr("d","M"+(55-t/1.7-a(u))+","+(87-s+u)+" "+(55+t/1.7-a(u))+","+(87-s-u)),c.append("path").attr("class","rbrow").attr("d","M"+(85-t/1.7+a(u))+","+(87-s-u)+" "+(85+t/1.7+a(u))+","+(87-s+u))}var d=.5,e=0,f=0,g=.5,h=.5,i=.5,j=.5,k=0,l=d3.svg.line().interpolate("cardinal-closed").x(function(a){return a.x}).y(function(a){return a.y}),m=d3.svg.line().interpolate("basis-closed").x(function(a){return a.x}).y(function(a){return a.y});return b.face=function(a){return arguments.length?(d=a,b):d},b.hair=function(a){return arguments.length?(e=a,b):e},b.mouth=function(a){return arguments.length?(f=a,b):f},b.noseh=function(a){return arguments.length?(g=a,b):g},b.nosew=function(a){return arguments.length?(h=a,b):h},b.eyeh=function(a){return arguments.length?(i=a,b):i},b.eyew=function(a){return arguments.length?(j=a,b):j},b.brow=function(a){return arguments.length?(k=a,b):k},b}d3.chernoff=function(){return b(Object)}}(),function(){d3.force_labels=function(){function a(){b.selection&&b.selection.each(function(a){var b=this.getBBox(),c=b.x+b.width/2,d=b.y+b.height/2;a.anchorPos.x=c,a.anchorPos.y=d,null===a.labelPos.x&&(a.labelPos.x=c,a.labelPos.y=d)})}var b=d3.layout.force();return b.on("tick.labels",a),b.update=function(c){b.selection=c;var d=[],e=[];c[0].forEach(function(a){if(a&&a.__data__){var b=a.__data__;a.labelPos||(a.labelPos={fixed:!1}),a.anchorPos||(a.anchorPos={fixed:!0}),b.labelPos=a.labelPos,b.anchorPos=a.anchorPos,e.push({target:a.anchorPos,source:a.labelPos}),d.push(a.anchorPos),d.push(a.labelPos)}}),b.stop().nodes(d).links(e),a(),b.start()},b}}(),a.d3plugins={};var b=a.Viz,c=a.d3plugins.Chernoff=b.extend({d3build:function(b){var c=this.attrs.face,d=this.attrs.stroke||"#000",e=b.chernoff().face(function(a){return a.f}).hair(function(a){return a.h}).mouth(function(a){return a.m}).nosew(function(a){return a.nw}).noseh(function(a){return a.nh}).eyew(function(a){return a.ew}).eyeh(function(a){return a.eh}).brow(function(a){return a.b}),f=this.svg(b);c&&(c=a.$.parseJSON(c),c.constructor!==Array&&(c=[c])),f.selectAll("g.chernoff").data(c).enter().append("svg:g").attr("class","chernoff").attr("stroke",d).attr("fill","none").attr("transform",function(a,b){return"scale(1."+b+")translate("+100*b+","+100*b+")"}).call(e)}});a.app.directive("chernoff",a.vizDirectiveFactory(c))});